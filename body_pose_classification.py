import sys
from turtle import width

import mediapipe as mp
from mediapipe.tasks import python
from mediapipe import solutions
from mediapipe.tasks.python import vision
from mediapipe.framework.formats import landmark_pb2


from sklearn.impute import SimpleImputer


import cv2
import numpy as np

import os

import pandas as pd

import joblib

mode = str(sys.argv[1])
mp_holistic = mp.solutions.holistic


def draw_landmarks_on_image(rgb_image, detection_result):
  annotated_image = np.copy(rgb_image)
  mp_drawing = mp.solutions.drawing_utils

  # Draw the face landmarks.
  mp_drawing.draw_landmarks(
    annotated_image, detection_result.face_landmarks, mp_holistic.FACEMESH_TESSELATION,
    mp_drawing.DrawingSpec(color=(80,110,10), thickness=1, circle_radius=1), 
    mp_drawing.DrawingSpec(color=(80,256,121), thickness=1, circle_radius=1)) 
  # Draw pose connections
  mp_drawing.draw_landmarks(annotated_image, detection_result.pose_landmarks, mp_holistic.POSE_CONNECTIONS,
                            mp_drawing.DrawingSpec(color=(0,0,204), thickness=3, circle_radius=4), 
                            mp_drawing.DrawingSpec(color=(91,229,255), thickness=3, circle_radius=2)
                            ) 
  return annotated_image


def make_detections(source):
  model = joblib.load('modello_addestrato_values.pkl')
  if mode=='-w':
    image=source
    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
  else:
    image = cv2.imread(source)
    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
  with mp_holistic.Holistic(
    min_detection_confidence=0.5, min_tracking_confidence=0.5, refine_face_landmarks=True) as holistic:
    results = holistic.process(image)
  annotated_image = draw_landmarks_on_image(image, results)
  pose = [[landmark.x, landmark.y, landmark.z, landmark.visibility] for landmark in results.pose_landmarks.landmark] if results.pose_landmarks else np.array([[-1,-1,-1,0] for i in range(33)])
  if results.face_landmarks:
    face = [[landmark.x, landmark.y, landmark.z, landmark.visibility] for landmark in results.face_landmarks.landmark] if results.face_landmarks else np.array([[-1,-1,-1,0] for i in range(478)])
  else:
    face = [0.5179775357246399,0.7014932632446289,-0.03430354967713356,0.0,0.5119093656539917,0.6355172991752625,-0.050986289978027344,0.0,0.5133762955665588,0.6600139141082764,-0.029713613912463188,0.0,0.5026783347129822,0.5836946368217468,-0.03289102762937546,0.0,0.5111612677574158,0.6169053316116333,-0.052847038954496384,0.0,0.5106829404830933,0.5955114960670471,-0.0471150167286396,0.0,0.5098713040351868,0.547364354133606,-0.016013285145163536,0.0,0.443891704082489,0.5651240348815918,0.02507721446454525,0.0,0.508590579032898,0.5080752372741699,-0.005737268831580877,0.0,0.5075570940971375,0.48465603590011597,-0.005251213442534208,0.0,0.5039879679679871,0.39950814843177795,0.014605414122343063,0.0,0.5182989835739136,0.7092552185058594,-0.033629801124334335,0.0,0.518610954284668,0.7181196212768555,-0.030795661732554436,0.0,0.5188160538673401,0.7247300148010254,-0.026838166639208794,0.0,0.5184485912322998,0.7252297401428223,-0.028706416487693787,0.0,0.5188825726509094,0.734363853931427,-0.03095431439578533,0.0,0.5193147659301758,0.7458110451698303,-0.034076835960149765,0.0,0.5196707844734192,0.7577203512191772,-0.034355755895376205,0.0,0.5183059573173523,0.7745106220245361,-0.02738851122558117,0.0,0.5126550793647766,0.6468127965927124,-0.046841710805892944,0.0,0.5048906803131104,0.6506831049919128,-0.03397998958826065,0.0,0.41274720430374146,0.513521134853363,0.07934504002332687,0.0,0.47186926007270813,0.5729093551635742,0.01287420466542244,0.0,0.46204614639282227,0.5771298408508301,0.013889534398913383,0.0,0.45278996229171753,0.5785834789276123,0.017014702782034874,0.0,0.4407920241355896,0.5726868510246277,0.02599266916513443,0.0,0.48015275597572327,0.5660053491592407,0.01387857273221016,0.0,0.4539186954498291,0.5238097906112671,0.012841623276472092,0.0,0.4657014012336731,0.5231322646141052,0.012673506513237953,0.0,0.44364818930625916,0.5299730896949768,0.016099657863378525,0.0,0.4376738965511322,0.5394785404205322,0.01998128741979599,0.0,0.4341624081134796,0.5858629941940308,0.030104009434580803,0.0,0.48588767647743225,0.8190829753875732,-0.01723477989435196,0.0,0.44063013792037964,0.5612323880195618,0.028658388182520866,0.0,0.4109339416027069,0.5911779999732971,0.07469397783279419,0.0,0.4242174029350281,0.5770236849784851,0.04145185649394989,0.0,0.4670385718345642,0.644569456577301,-0.0037298069801181555,0.0,0.5072353482246399,0.6998825073242188,-0.03230826556682587,0.0,0.5094503164291382,0.7196213006973267,-0.02893069200217724,0.0,0.4967518746852875,0.7112994194030762,-0.02670334279537201,0.0,0.4903540313243866,0.7224757671356201,-0.020326536148786545,0.0,0.5016359090805054,0.7236323356628418,-0.024967031553387642,0.0,0.4955892264842987,0.7288241982460022,-0.01895252987742424,0.0,0.4761018455028534,0.7581727504730225,-0.010213286615908146,0.0,0.5043368339538574,0.6369999051094055,-0.049830276519060135,0.0,0.5023962259292603,0.6196738481521606,-0.05135698989033699,0.0,0.4246599078178406,0.5296278595924377,0.025852307677268982,0.0,0.48375093936920166,0.5965436697006226,-0.0012966892682015896,0.0,0.4836390018463135,0.6433805227279663,-0.02529141679406166,0.0,0.48254790902137756,0.6353904008865356,-0.021669995039701462,0.0,0.4398021697998047,0.6527696251869202,0.010373345576226711,0.0,0.5023249983787537,0.5996990203857422,-0.04375290125608444,0.0,0.44409653544425964,0.5041916966438293,0.009243463166058064,0.0,0.4317874610424042,0.5138975977897644,0.01716412417590618,0.0,0.41950368881225586,0.47647881507873535,0.06305519491434097,0.0,0.48695123195648193,0.5077027678489685,-0.0017302921041846275,0.0,0.47633856534957886,0.5286295413970947,0.014812939800322056,0.0,0.46834510564804077,0.7436776757240295,-0.0053874654695391655,0.0,0.42906105518341064,0.7622400522232056,0.08093221485614777,0.0,0.4914382994174957,0.6518818140029907,-0.02290971204638481,0.0,0.4993889033794403,0.6560220718383789,-0.025286300107836723,0.0,0.4843434691429138,0.7398420572280884,-0.006639973726123571,0.0,0.4867073595523834,0.7385861873626709,-0.009527844376862049,0.0,0.42694514989852905,0.5050013661384583,0.023429233580827713,0.0,0.48408037424087524,0.6530737280845642,-0.02095189318060875,0.0,0.4618489146232605,0.5010080933570862,0.0028018387965857983,0.0,0.459071546792984,0.4878532290458679,0.0024305114056915045,0.0,0.4526086449623108,0.4213956594467163,0.028080159798264503,0.0,0.42505380511283875,0.48808982968330383,0.04071775823831558,0.0,0.45876625180244446,0.4515155553817749,0.015068145468831062,0.0,0.41983920335769653,0.524512529373169,0.03536423668265343,0.0,0.41735225915908813,0.5184146165847778,0.056237056851387024,0.0,0.5081174969673157,0.7103645205497742,-0.03173080459237099,0.0,0.4991908073425293,0.7178736329078674,-0.026421863585710526,0.0,0.4929012656211853,0.725715696811676,-0.020541569218039513,0.0,0.49408742785453796,0.655347466468811,-0.02142791636288166,0.0,0.48560330271720886,0.7392520904541016,-0.008179857395589352,0.0,0.4890938997268677,0.7402253746986389,-0.015618175268173218,0.0,0.4879937469959259,0.7378806471824646,-0.009914754889905453,0.0,0.4947941303253174,0.6419919729232788,-0.03522295504808426,0.0,0.4973951280117035,0.7308709025382996,-0.01762448623776436,0.0,0.5033762454986572,0.727471113204956,-0.021584995090961456,0.0,0.5105506777763367,0.7254878282546997,-0.025177884846925735,0.0,0.5068039298057556,0.7758421897888184,-0.02643948420882225,0.0,0.5083897709846497,0.7582011222839355,-0.03303181752562523,0.0,0.5086582899093628,0.7462742924690247,-0.032680660486221313,0.0,0.5092394948005676,0.7347376942634583,-0.02922946773469448,0.0,0.5102158188819885,0.7260773181915283,-0.027007045224308968,0.0,0.4971065819263458,0.7310758829116821,-0.018959354609251022,0.0,0.4951883554458618,0.7358694076538086,-0.021209608763456345,0.0,0.49313265085220337,0.7418861389160156,-0.023496799170970917,0.0,0.49135836958885193,0.7486653327941895,-0.02236349694430828,0.0,0.4770256280899048,0.7060165405273438,-0.015509668737649918,0.0,0.4147968888282776,0.6770017743110657,0.10519852489233017,0.0,0.5130863785743713,0.6529955863952637,-0.03527122735977173,0.0,0.49273446202278137,0.734140157699585,-0.013886723667383194,0.0,0.4909953474998474,0.7370137572288513,-0.015374907292425632,0.0,0.5022432804107666,0.6627712845802307,-0.027002278715372086,0.0,0.48831504583358765,0.6643896102905273,-0.015730533748865128,0.0,0.5009175539016724,0.6595054268836975,-0.026216672733426094,0.0,0.4742595851421356,0.6100795269012451,0.0013464849907904863,0.0,0.45984604954719543,0.6257199048995972,0.003935237415134907,0.0,0.4817873239517212,0.6450687646865845,-0.017067044973373413,0.0,0.432040810585022,0.44528040289878845,0.044516563415527344,0.0,0.4381638765335083,0.4650460481643677,0.027320297434926033,0.0,0.4403287172317505,0.4922255277633667,0.012901888228952885,0.0,0.48449569940567017,0.7660698890686035,-0.016813715919852257,0.0,0.48165982961654663,0.4857625365257263,-0.003394257975742221,0.0,0.48049721121788025,0.4448705315589905,0.0073127662762999535,0.0,0.4758143723011017,0.40733274817466736,0.01771215908229351,0.0,0.4452419877052307,0.5776568055152893,0.02166309952735901,0.0,0.42567211389541626,0.6009786128997803,0.03487439081072807,0.0,0.48558276891708374,0.5595676898956299,0.015486487187445164,0.0,0.43005162477493286,0.5513118505477905,0.02883974276483059,0.0,0.4899730086326599,0.5825112462043762,-0.00409731874242425,0.0,0.48850783705711365,0.6330623626708984,-0.03412746265530586,0.0,0.4173195958137512,0.6189454197883606,0.04443732276558876,0.0,0.43140116333961487,0.6110738515853882,0.024696853011846542,0.0,0.44307273626327515,0.6136063933372498,0.014668533578515053,0.0,0.4612557291984558,0.6055789589881897,0.009677918627858162,0.0,0.47466495633125305,0.5946053862571716,0.00748333428055048,0.0,0.4845329523086548,0.583154559135437,0.005282100755721331,0.0,0.5011966824531555,0.5542130470275879,-0.012169355526566505,0.0,0.42008864879608154,0.6557053327560425,0.038115955889225006,0.0,0.42361733317375183,0.5518627762794495,0.034311048686504364,0.0,0.5081514120101929,0.6472539305686951,-0.046081095933914185,0.0,0.48498058319091797,0.6115700006484985,-0.007090522907674313,0.0,0.4099082946777344,0.5964502692222595,0.10689998418092728,0.0,0.49140051007270813,0.5709924101829529,0.004691044334322214,0.0,0.48141294717788696,0.6483795046806335,-0.007792667951434851,0.0,0.43660399317741394,0.5631842613220215,0.030479397624731064,0.0,0.48772597312927246,0.6234387159347534,-0.029591154307127,0.0,0.42049163579940796,0.7194409370422363,0.09587954729795456,0.0,0.4859144389629364,0.5531022548675537,0.01874248869717121,0.0,0.4948166608810425,0.6094304919242859,-0.03830833360552788,0.0,0.4469103515148163,0.7925505042076111,0.02492556720972061,0.0,0.4498326778411865,0.8170989751815796,0.03992011770606041,0.0,0.4139151871204376,0.6670306921005249,0.07181452959775925,0.0,0.4356904625892639,0.7715520858764648,0.04035787284374237,0.0,0.41389527916908264,0.5527545809745789,0.06858131289482117,0.0,0.4848567247390747,0.8410549163818359,-0.013501280918717384,0.0,0.5096028447151184,0.653084397315979,-0.03448352590203285,0.0,0.477444052696228,0.6278131604194641,-0.004589082207530737,0.0,0.41819465160369873,0.5829246640205383,0.051274631172418594,0.0,0.45276370644569397,0.5682293176651001,0.018572522327303886,0.0,0.4610411524772644,0.5673402547836304,0.015836486592888832,0.0,0.4872395992279053,0.7439531683921814,-0.014111463911831379,0.0,0.42397966980934143,0.6918988823890686,0.03692927956581116,0.0,0.5035026669502258,0.8650825023651123,-0.01393824815750122,0.0,0.475445955991745,0.8494639992713928,0.009273036383092403,0.0,0.4636048376560211,0.8369752764701843,0.02271411567926407,0.0,0.5055184960365295,0.4400520324707031,0.004187262151390314,0.0,0.5234593152999878,0.8645347356796265,-0.017816154286265373,0.0,0.46951305866241455,0.5640596151351929,0.015203816816210747,0.0,0.47750088572502136,0.5592431426048279,0.01646183431148529,0.0,0.48299917578697205,0.5559298396110535,0.018570588901638985,0.0,0.418192595243454,0.5512470006942749,0.04474162310361862,0.0,0.4760186970233917,0.5429921746253967,0.01614721678197384,0.0,0.4670976400375366,0.5398967266082764,0.014973586425185204,0.0,0.4582335352897644,0.5407260656356812,0.015737999230623245,0.0,0.44979241490364075,0.545772135257721,0.018215415999293327,0.0,0.4449341893196106,0.5521206259727478,0.021299263462424278,0.0,0.40999865531921387,0.5515083074569702,0.09580341726541519,0.0,0.4473950266838074,0.5670810341835022,0.02204446867108345,0.0,0.5139397382736206,0.6755881309509277,-0.029192812740802765,0.0,0.48517143726348877,0.6917505264282227,-0.019568292424082756,0.0,0.49089381098747253,0.6478564143180847,-0.025761937722563744,0.0,0.5018400549888611,0.6794649362564087,-0.028246499598026276,0.0,0.5094488859176636,0.5287127494812012,-0.007104082964360714,0.0,0.4593367576599121,0.8130016326904297,0.011788464151322842,0.0,0.47150176763534546,0.8277117013931274,-0.0005963019211776555,0.0,0.501703679561615,0.8484529852867126,-0.02488165907561779,0.0,0.4392348825931549,0.7943044900894165,0.061027925461530685,0.0,0.48263582587242126,0.548703670501709,0.01776530221104622,0.0,0.4959316849708557,0.5814787149429321,-0.017620133236050606,0.0,0.5221193432807922,0.847926139831543,-0.02844192087650299,0.0,0.48829275369644165,0.8591848611831665,-0.004366348031908274,0.0,0.41912388801574707,0.7060006260871887,0.06587480008602142,0.0,0.5030226707458496,0.7279861569404602,-0.023267321288585663,0.0,0.5011547803878784,0.7351576089859009,-0.025705762207508087,0.0,0.4996664822101593,0.7441704273223877,-0.02843119204044342,0.0,0.49868470430374146,0.7546732425689697,-0.02821851521730423,0.0,0.49463173747062683,0.7722875475883484,-0.022909078747034073,0.0,0.4909146726131439,0.7338364720344543,-0.013775286264717579,0.0,0.48851242661476135,0.7330499291419983,-0.013613554649055004,0.0,0.4863130748271942,0.7317854762077332,-0.013262046501040459,0.0,0.47093573212623596,0.7239440679550171,-0.009974339045584202,0.0,0.43512481451034546,0.6952120065689087,0.016228821128606796,0.0,0.49569347500801086,0.5669069886207581,-0.007330080959945917,0.0,0.4909624755382538,0.5369076132774353,0.012363391928374767,0.0,0.48593074083328247,0.5408788919448853,0.016320180147886276,0.0,0.49308347702026367,0.7342513799667358,-0.013051720336079597,0.0,0.43719086050987244,0.7414267659187317,0.025253338739275932,0.0,0.4980180859565735,0.5325955152511597,-0.00025606437702663243,0.0,0.4898563027381897,0.7961178421974182,-0.019543353468179703,0.0,0.5104426145553589,0.5789152979850769,-0.036413274705410004,0.0,0.5018723607063293,0.5695836544036865,-0.023316478356719017,0.0,0.5101652145385742,0.5635705590248108,-0.025718960911035538,0.0,0.4901857376098633,0.6102044582366943,-0.01973789557814598,0.0,0.5208290219306946,0.8258438110351562,-0.03192731738090515,0.0,0.5194933414459229,0.7992141246795654,-0.029668647795915604,0.0,0.5043423771858215,0.8007113337516785,-0.027069635689258575,0.0,0.4677347242832184,0.770671010017395,-0.005185142625123262,0.0,0.4745095670223236,0.665666401386261,-0.006790700368583202,0.0,0.4780100882053375,0.7866657972335815,-0.01241130568087101,0.0,0.45333606004714966,0.6700441241264343,-0.0017115026712417603,0.0,0.46662843227386475,0.6865941882133484,-0.0071069663390517235,0.0,0.4470048248767853,0.703418493270874,0.003045721910893917,0.0,0.5020543336868286,0.826644241809845,-0.028156999498605728,0.0,0.48514193296432495,0.6233143210411072,-0.013902035541832447,0.0,0.46073925495147705,0.7891069054603577,0.0027837392408400774,0.0,0.4732418358325958,0.8058425784111023,-0.006609327159821987,0.0,0.45925581455230713,0.7497396469116211,-0.000672997732181102,0.0,0.4283617436885834,0.722809910774231,0.03653404861688614,0.0,0.44858798384666443,0.7572177648544312,0.00941469706594944,0.0,0.42567527294158936,0.7412810325622559,0.05721190199255943,0.0,0.46058109402656555,0.71419358253479,-0.004677717108279467,0.0,0.4906010925769806,0.5962503552436829,-0.011872988194227219,0.0,0.4917292296886444,0.6393712162971497,-0.036681972444057465,0.0,0.48681485652923584,0.6478333473205566,-0.027056772261857986,0.0,0.494941383600235,0.6252530217170715,-0.043022844940423965,0.0,0.4816180169582367,0.5225115418434143,0.010882747359573841,0.0,0.4641414284706116,0.5149410963058472,0.010228700935840607,0.0,0.4495275914669037,0.516408383846283,0.011339336633682251,0.0,0.43837085366249084,0.52372145652771,0.015480508096516132,0.0,0.4316684603691101,0.5351898074150085,0.02149006724357605,0.0,0.4312528967857361,0.5696110725402832,0.03436507657170296,0.0,0.41083163022994995,0.6290731430053711,0.07380640506744385,0.0,0.43900978565216064,0.5916528105735779,0.02431097812950611,0.0,0.4486522376537323,0.5937057733535767,0.01765591651201248,0.0,0.4613662660121918,0.5902829170227051,0.013017778284847736,0.0,0.4735572338104248,0.5829545855522156,0.01101930532604456,0.0,0.4830167889595032,0.5740969181060791,0.010918984189629555,0.0,0.4892866313457489,0.5659922957420349,0.010588436387479305,0.0,0.4118445813655853,0.6369614601135254,0.10953009873628616,0.0,0.48763424158096313,0.6539844870567322,-0.022824354469776154,0.0,0.4960104525089264,0.5948898792266846,-0.02657453902065754,0.0,0.4980364441871643,0.6369813084602356,-0.04465622454881668,0.0,0.5038626790046692,0.6464590430259705,-0.041998859494924545,0.0,0.49851399660110474,0.641294538974762,-0.04024188965559006,0.0,0.49085327982902527,0.6597939729690552,-0.02045915462076664,0.0,0.5053929090499878,0.6470180749893188,-0.04471476376056671,0.0,0.5068541169166565,0.6527740359306335,-0.03420185670256615,0.0,0.489078551530838,0.5524444580078125,0.01693163439631462,0.0,0.49372389912605286,0.5545031428337097,0.010410849004983902,0.0,0.4960094392299652,0.5555311441421509,0.003030659630894661,0.0,0.4424150288105011,0.5568967461585999,0.024509498849511147,0.0,0.43478474020957947,0.5504450798034668,0.025353942066431046,0.0,0.5186455845832825,0.5806883573532104,-0.03367217257618904,0.0,0.5821244120597839,0.5395561456680298,0.019458986818790436,0.0,0.5213896036148071,0.6473790407180786,-0.03461041674017906,0.0,0.6055848002433777,0.47657284140586853,0.0717521384358406,0.0,0.55549156665802,0.5585362315177917,0.00922437198460102,0.0,0.5651428699493408,0.5594017505645752,0.009537317790091038,0.0,0.5741392374038696,0.5576728582382202,0.011992190033197403,0.0,0.5856979489326477,0.545529842376709,0.02003297582268715,0.0,0.5469717979431152,0.5546789169311523,0.010963358916342258,0.0,0.5664445757865906,0.5025210380554199,0.008336811326444149,0.0,0.5549684762954712,0.5068384408950806,0.009063689969480038,0.0,0.5773741006851196,0.5039086937904358,0.010943344794213772,0.0,0.5846383571624756,0.5104689598083496,0.014360769651830196,0.0,0.5927416086196899,0.5565646886825562,0.02373315766453743,0.0,0.5566892623901367,0.8066371083259583,-0.019850200042128563,0.0,0.5850878357887268,0.5333624482154846,0.022751279175281525,0.0,0.6155932545661926,0.5532006025314331,0.06601691991090775,0.0,0.6014879941940308,0.5424226522445679,0.03430197015404701,0.0,0.5608630180358887,0.6278719305992126,-0.007307502441108227,0.0,0.5282584428787231,0.6966054439544678,-0.03337438777089119,0.0,0.5276746153831482,0.7169816493988037,-0.02991338260471821,0.0,0.5393529534339905,0.7047229409217834,-0.028906475752592087,0.0,0.5462565422058105,0.714033842086792,-0.023268699645996094,0.0,0.5355023145675659,0.7188150882720947,-0.02689867466688156,0.0,0.5415985584259033,0.7223103046417236,-0.02143159694969654,0.0,0.5603583455085754,0.7435450553894043,-0.013803502544760704,0.0,0.5197227597236633,0.6340646743774414,-0.050322726368904114,0.0,0.5202939510345459,0.6162891387939453,-0.051980406045913696,0.0,0.5951791405677795,0.4945693612098694,0.01916392147541046,0.0,0.5405264496803284,0.5858454704284668,-0.00366202462464571,0.0,0.5425688624382019,0.6326618194580078,-0.027639400213956833,0.0,0.5432120561599731,0.6244326829910278,-0.02411242574453354,0.0,0.5898069143295288,0.6257151365280151,0.004428443498909473,0.0,0.5194061398506165,0.596454918384552,-0.04454099014401436,0.0,0.572123646736145,0.4784051775932312,0.004763990640640259,0.0,0.5858087539672852,0.482272207736969,0.01149186585098505,0.0,0.5950600504875183,0.44251561164855957,0.056296564638614655,0.0,0.5302153825759888,0.5009903907775879,-0.003180835861712694,0.0,0.5456554293632507,0.5167838335037231,0.011821439489722252,0.0,0.5671688318252563,0.7267040014266968,-0.00964297540485859,0.0,0.6159483194351196,0.7284600734710693,0.0737021192908287,0.0,0.5356988310813904,0.6438280940055847,-0.024572215974330902,0.0,0.528021514415741,0.6510412096977234,-0.02611144818365574,0.0,0.5532589554786682,0.7301896810531616,-0.010330263525247574,0.0,0.5508604645729065,0.7296261787414551,-0.012824006378650665,0.0,0.5894772410392761,0.47109705209732056,0.017373379319906235,0.0,0.5432218313217163,0.642708420753479,-0.0232328362762928,0.0,0.5540781021118164,0.4835227429866791,-0.0002944640873465687,0.0,0.5547032952308655,0.4693770408630371,-0.0007795645506121218,0.0,0.5567478537559509,0.40115612745285034,0.02418925240635872,0.0,0.590208113193512,0.4557691812515259,0.03409047797322273,0.0,0.5528178215026855,0.43299633264541626,0.011390424333512783,0.0,0.5992067456245422,0.4874178171157837,0.028211986646056175,0.0,0.6011408567428589,0.48298996686935425,0.04852928966283798,0.0,0.5282964706420898,0.7072962522506714,-0.03280777856707573,0.0,0.53750079870224,0.7121901512145996,-0.02852896973490715,0.0,0.544054388999939,0.7181808948516846,-0.023278677836060524,0.0,0.5333806276321411,0.6483570337295532,-0.022811392322182655,0.0,0.5519991517066956,0.7299854159355164,-0.011631970293819904,0.0,0.5485384464263916,0.7317564487457275,-0.018618525937199593,0.0,0.5495668649673462,0.7292760610580444,-0.013104512356221676,0.0,0.5308202505111694,0.6350733041763306,-0.03680938854813576,0.0,0.5398430824279785,0.7249075174331665,-0.01996968686580658,0.0,0.533991277217865,0.7231890559196472,-0.023387815803289413,0.0,0.5269423127174377,0.7232049107551575,-0.026199573650956154,0.0,0.5303354263305664,0.7717903256416321,-0.027363037690520287,0.0,0.5307194590568542,0.75479656457901,-0.03412478789687157,0.0,0.5296400189399719,0.7429990172386169,-0.03380933403968811,0.0,0.5282190442085266,0.7318028211593628,-0.030366672202944756,0.0,0.5265772342681885,0.7236839532852173,-0.028073608875274658,0.0,0.5396656394004822,0.7250109314918518,-0.02131292223930359,0.0,0.542124330997467,0.7290685176849365,-0.023561986163258553,0.0,0.544632613658905,0.7343369722366333,-0.02596166916191578,0.0,0.5468170046806335,0.740450918674469,-0.02497371844947338,0.0,0.5545881986618042,0.6928492784500122,-0.018832022324204445,0.0,0.6217591762542725,0.6392286419868469,0.09710712730884552,0.0,0.5442754626274109,0.7268308997154236,-0.016775811091065407,0.0,0.5463767051696777,0.729198694229126,-0.018296871334314346,0.0,0.5253903269767761,0.6590674519538879,-0.027823813259601593,0.0,0.5402209162712097,0.6557213068008423,-0.01755724847316742,0.0,0.5266267657279968,0.6552363634109497,-0.02700711600482464,0.0,0.5510900616645813,0.5959582924842834,-0.0017790576675906777,0.0,0.5669757723808289,0.6063337326049805,-0.00031471249531023204,0.0,0.5450960397720337,0.6339240074157715,-0.01954662799835205,0.0,0.5796302556991577,0.416665256023407,0.039001259952783585,0.0,0.5748711824417114,0.43822622299194336,0.021991407498717308,0.0,0.5741749405860901,0.46465790271759033,0.008075674995779991,0.0,0.5524625778198242,0.7541199922561646,-0.019771482795476913,0.0,0.5319718718528748,0.477606862783432,-0.0049885292537510395,0.0,0.5305907726287842,0.4350574314594269,0.0054209185764193535,0.0,0.5323716402053833,0.39633625745773315,0.01577766425907612,0.0,0.5816914439201355,0.5532753467559814,0.016067244112491608,0.0,0.6023452281951904,0.5684031844139099,0.027791021391749382,0.0,0.5410454273223877,0.5505967736244202,0.012920019216835499,0.0,0.5931370258331299,0.5186257362365723,0.022366885095834732,0.0,0.5332112312316895,0.5741423964500427,-0.005986248143017292,0.0,0.5363649129867554,0.6241337656974792,-0.03600563853979111,0.0,0.6107832789421082,0.5832089781761169,0.03644310310482979,0.0,0.5974504947662354,0.5818163752555847,0.018037084490060806,0.0,0.585961639881134,0.5893691182136536,0.00897685345262289,0.0,0.5676359534263611,0.5879226922988892,0.005330786108970642,0.0,0.5537546277046204,0.5815961360931396,0.004159030504524708,0.0,0.5430319905281067,0.5740517973899841,0.0028299004770815372,0.0,0.5192123651504517,0.5506423115730286,-0.012945229187607765,0.0,0.6114236116409302,0.620945155620575,0.03012348711490631,0.0,0.5990224480628967,0.516710102558136,0.027234544977545738,0.0,0.517210066318512,0.64546138048172,-0.04648209735751152,0.0,0.5399107336997986,0.6014999747276306,-0.0093888770788908,0.0,0.6181134581565857,0.55770343542099,0.09873444586992264,0.0,0.5348500609397888,0.5649859309196472,0.002735729329288006,0.0,0.5461167693138123,0.6371492147445679,-0.010293478146195412,0.0,0.5890564918518066,0.5333147644996643,0.024338249117136,0.0,0.536677896976471,0.6144209504127502,-0.03149818629026413,0.0,0.620503306388855,0.6831039190292358,0.08822561055421829,0.0,0.5402781367301941,0.5441991686820984,0.01607953943312168,0.0,0.5280550122261047,0.6031920909881592,-0.03967885300517082,0.0,0.5971472859382629,0.7659895420074463,0.0189259871840477,0.0,0.5982667803764343,0.7908836603164673,0.03435554355382919,0.0,0.6201263666152954,0.6293387413024902,0.06300314515829086,0.0,0.6075707674026489,0.7408909797668457,0.03327372670173645,0.0,0.60835862159729,0.5160096883773804,0.06031223386526108,0.0,0.5601861476898193,0.8279055953025818,-0.016379954293370247,0.0,0.5166037678718567,0.6517601609230042,-0.03472627326846123,0.0,0.5488539934158325,0.6150503754615784,-0.00742529658600688,0.0,0.608275294303894,0.5453893542289734,0.04340318217873573,0.0,0.5734223127365112,0.5475764870643616,0.013656144961714745,0.0,0.5652971267700195,0.5496081113815308,0.01145454216748476,0.0,0.5506846904754639,0.734801173210144,-0.017292574048042297,0.0,0.611208975315094,0.6582232117652893,0.029169348999857903,0.0,0.5437273383140564,0.8581539392471313,-0.015370264649391174,0.0,0.5727097392082214,0.8321669697761536,0.005610308609902859,0.0,0.5848419666290283,0.8155267238616943,0.018144534900784492,0.0,0.557014524936676,0.548923671245575,0.011482726782560349,0.0,0.5490174293518066,0.5468395352363586,0.013274132274091244,0.0,0.5433892607688904,0.5458642244338989,0.01570434309542179,0.0,0.6040045022964478,0.5135312080383301,0.03709891438484192,0.0,0.5485493540763855,0.5306717753410339,0.01291421428322792,0.0,0.556710422039032,0.5243704915046692,0.011206968687474728,0.0,0.5652791857719421,0.5219907760620117,0.011378475464880466,0.0,0.5739856362342834,0.5232977271080017,0.013218912295997143,0.0,0.5794447064399719,0.5269309878349304,0.015910057350993156,0.0,0.6126571893692017,0.5132239460945129,0.0878506675362587,0.0,0.5787175893783569,0.543754518032074,0.016684213653206825,0.0,0.5449953675270081,0.6816444396972656,-0.022023271769285202,0.0,0.535689651966095,0.6395395994186401,-0.027395522221922874,0.0,0.5267360806465149,0.6753178834915161,-0.02927953191101551,0.0,0.585442066192627,0.7908422350883484,0.006932288873940706,0.0,0.5735299587249756,0.8098536729812622,-0.0044801924377679825,0.0,0.5430610179901123,0.8412624001502991,-0.026450011879205704,0.0,0.6080488562583923,0.7640174627304077,0.05453071370720863,0.0,0.5428111553192139,0.5387614369392395,0.014855128712952137,0.0,0.5262267589569092,0.5756816267967224,-0.018911056220531464,0.0,0.5593526363372803,0.8466065526008606,-0.007099345326423645,0.0,0.6188997626304626,0.6698232293128967,0.05748257040977478,0.0,0.5337286591529846,0.7235437035560608,-0.02504478394985199,0.0,0.5362061858177185,0.7299591898918152,-0.02757967822253704,0.0,0.5383396148681641,0.7382947206497192,-0.03045935370028019,0.0,0.5401307344436646,0.7483634948730469,-0.03032648377120495,0.0,0.5424683690071106,0.7637342214584351,-0.02506537362933159,0.0,0.546445906162262,0.7259541749954224,-0.016768591478466988,0.0,0.548764705657959,0.7243694067001343,-0.01686529815196991,0.0,0.5509097576141357,0.722253143787384,-0.016700536012649536,0.0,0.5624499917030334,0.7083020210266113,-0.013988113030791283,0.0,0.5988727807998657,0.6659010052680969,0.009793248027563095,0.0,0.5259921550750732,0.5610299706459045,-0.008639072068035603,0.0,0.5320817828178406,0.5309362411499023,0.010634788312017918,0.0,0.5382409691810608,0.5325759649276733,0.013833277858793736,0.0,0.5442776083946228,0.7270533442497253,-0.015939025208353996,0.0,0.6018102169036865,0.7119966745376587,0.01868339814245701,0.0,0.5229843258857727,0.5304029583930969,-0.001278799376450479,0.0,0.5502050518989563,0.7854254245758057,-0.02188998833298683,0.0,0.5190112590789795,0.5662345290184021,-0.024016261100769043,0.0,0.5338859558105469,0.6022147536277771,-0.021482855081558228,0.0,0.535336971282959,0.7953115701675415,-0.02822086401283741,0.0,0.5708792209625244,0.7525680065155029,-0.009258613921701908,0.0,0.5546261072158813,0.6517884731292725,-0.009839040227234364,0.0,0.5616769194602966,0.7719037532806396,-0.01568031683564186,0.0,0.5769710540771484,0.6479474902153015,-0.006259214133024216,0.0,0.564440131187439,0.6695349216461182,-0.010846526362001896,0.0,0.5866360068321228,0.6785882115364075,-0.00223472248762846,0.0,0.5402494072914124,0.8200563192367554,-0.029663465917110443,0.0,0.5402175188064575,0.6133536100387573,-0.016111064702272415,0.0,0.5807010531425476,0.767818808555603,-0.0017594372620806098,0.0,0.568943977355957,0.7889089584350586,-0.010158051736652851,0.0,0.5777209997177124,0.7290465235710144,-0.005491802468895912,0.0,0.6099244952201843,0.6902276873588562,0.029182737693190575,0.0,0.5904674530029297,0.7320069670677185,0.003939276095479727,0.0,0.6156139373779297,0.7070969939231873,0.04919378459453583,0.0,0.573064386844635,0.6946278214454651,-0.00911114551126957,0.0,0.5328947901725769,0.5883147120475769,-0.013717621564865112,0.0,0.5335845351219177,0.6314190030097961,-0.038381896913051605,0.0,0.5397213697433472,0.6381549835205078,-0.02904181182384491,0.0,0.5286746621131897,0.6189009547233582,-0.044320281594991684,0.0,0.5389590859413147,0.5132830142974854,0.008548802696168423,0.0,0.5544638633728027,0.4985702633857727,0.006928557064384222,0.0,0.5689014196395874,0.49360164999961853,0.006952510681003332,0.0,0.5808829069137573,0.4955289363861084,0.010159986093640327,0.0,0.5892297029495239,0.5034746527671814,0.015463517047464848,0.0,0.5942741632461548,0.53765469789505,0.027831610292196274,0.0,0.6193129420280457,0.5906423926353455,0.0648629441857338,0.0,0.5886154174804688,0.5648582577705383,0.018282266333699226,0.0,0.5791022777557373,0.5712006688117981,0.01245049387216568,0.0,0.5665633678436279,0.5722890496253967,0.008714738301932812,0.0,0.5542707443237305,0.5691779851913452,0.007570524234324694,0.0,0.5444514155387878,0.5639852285385132,0.008298042230308056,0.0,0.5374073386192322,0.5585058927536011,0.008430295623838902,0.0,0.6205686330795288,0.5985273122787476,0.10131353884935379,0.0,0.5396230816841125,0.6447123885154724,-0.024763841181993484,0.0,0.5264639854431152,0.5891594290733337,-0.02793365716934204,0.0,0.5264383554458618,0.6315308213233948,-0.04573589190840721,0.0,0.5217123627662659,0.6429111957550049,-0.042604152113199234,0.0,0.5267066955566406,0.6358861923217773,-0.04133475944399834,0.0,0.5371081233024597,0.6517850160598755,-0.022073796018958092,0.0,0.5200601816177368,0.644126296043396,-0.04520818963646889,0.0,0.5194127559661865,0.6502907872200012,-0.034650109708309174,0.0,0.5368714928627014,0.544926643371582,0.014700479805469513,0.0,0.5315812826156616,0.5491451025009155,0.0087007787078619,0.0,0.5282871723175049,0.5517883896827698,0.0016579717630520463,0.0,0.5825856924057007,0.5301063060760498,0.018860770389437675,0.0,0.58893221616745,0.5197739601135254,0.019389014691114426,0.0,0.46180304884910583,0.5525223612785339,0.019238505512475967,0.0,0.4723284840583801,0.5494406223297119,0.019238505512475967,0.0,0.4602140784263611,0.5370636582374573,0.019238505512475967,0.0,0.4512694478034973,0.5555842518806458,0.019238505512475967,0.0,0.46333789825439453,0.5679293870925903,0.019238505512475967,0.0,0.5649002194404602,0.5336310863494873,0.01493065245449543,0.0,0.575924277305603,0.5327744483947754,0.01493065245449543,0.0,0.5646503567695618,0.517052948474884,0.01493065245449543,0.0,0.5538325905799866,0.5344366431236267,0.01493065245449543,0.0,0.5651332139968872,0.5501896739006042,0.01493065245449543,0.0]
  coords = np.concatenate((pose, face), axis=None)
  X=pd.DataFrame([coords])
  body_language_class = model.predict(X)[0]
  body_language_prob = model.predict_proba(X)[0]
  if mode == '-w':
    text = body_language_class + ": " + str('{:.2%}'.format(round(max(body_language_prob),2)))
    cv2.putText(annotated_image, text, (10, 100),cv2.FONT_HERSHEY_COMPLEX_SMALL, 5, (0,0,204), 10, cv2.LINE_AA)
  else:
    text=''
    i=0
    classes = ['angry', 'disgust', 'fear','happy', 'sad', 'surprise']
    for prob in body_language_prob.flatten():
      text += classes[i]+ ": " +'{:.2%}'.format(round(prob,2)) + "\n"
      i=i+1
    y0, dy= 100,100
    cv2.rectangle(annotated_image, (10, 10), (1200, 110*6), (151, 207, 255), -1)
    for i, line in enumerate(text.split('\n')):
      y = y0 + i*dy
      cv2.putText(annotated_image, line, (10, y),cv2.FONT_HERSHEY_COMPLEX_SMALL, 5, (0,0,204), 10, cv2.LINE_AA)

  return results, annotated_image

def check_landmarks(emotion):
  for img in os.listdir("./dataset/"+ emotion):
    if not img.startswith('.'):
      results,img=make_detections("./dataset/"+ emotion + "/" + img)
      if not results.pose_landmarks and not results.face_landmarks:
        print(img)
      else:
        print('ok')

path=""
if mode == "-w": #webcam
  cap = cv2.VideoCapture(0)
  cap.set(cv2.CAP_PROP_BUFFERSIZE, 2)
  while cap.isOpened():
    success, image = cap.read()
    if not success:
      print("Ignoring empty camera frame.")
      continue
    image.flags.writeable = False
    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
    try:
      results, image=make_detections(image)
    except:
      pass
    cv2.imshow('MediaPipe Holistic', image)
    if cv2.waitKey(10) & 0xFF == ord('q'):
        break
  cap.release()
  cv2.destroyAllWindows()
elif mode=='check':
  check_landmarks(str(sys.argv[2]))
else: #img
  if len(sys.argv) == 3 :
    path = str(sys.argv[2])
    print("------------",path)
  else :
    while not os.path.isfile(path):
      path = input("Path is invalid. Please enter valid img path: ")
  results, img=make_detections(path) 
  img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
   
  cv2.imshow("image",img)
  cv2.waitKey(0)
  cv2.destroyAllWindows()

